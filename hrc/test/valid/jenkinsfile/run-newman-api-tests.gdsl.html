  0: <span class='def-Comment def-Syntax'>#!</span><span class='def-VarStrong def-Var'>groovy</span>
  1: <span class='def-Keyword'>import</span> org<span class='def-Symbol'>.</span>jenkinsci<span class='def-Symbol'>.</span>plugins<span class='def-Symbol'>.</span>workflow<span class='def-Symbol'>.</span>steps<span class='def-Symbol'>.</span>FlowInterruptedException
  2: 
  3: DEFAULT_EMAIL <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>anthonyl22@gmail.com</span><span class='def-StringEdge def-String'>'</span>
  4: 
  5: <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>node</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
  6: 
  7:     <span class='def-Keyword'>def</span> DEFAULT_ADMIN_JENKINS_USER_ID <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ADD HERE</span><span class='def-StringEdge def-String'>'</span>
  8:     <span class='def-Keyword'>def</span> DEFAULT_PROJECT_URL <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ADD HERE</span><span class='def-StringEdge def-String'>'</span>
  9:     <span class='def-Keyword'>def</span> COLLECTIONS_PATH <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>src/test/resources/postman</span><span class='def-StringEdge def-String'>'</span>
 10:     <span class='def-Keyword'>def</span> GLOBALS_ENVIRONMENT_FILE <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>globals.environment.json</span><span class='def-StringEdge def-String'>'</span>
 11: 
 12:     <span class='def-FunctionKeyword def-Keyword'>String</span> collectionName <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>smoke</span><span class='def-StringEdge def-String'>'</span>
 13:     <span class='def-Keyword'>def</span> testEnvironment <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>test</span><span class='def-StringEdge def-String'>'</span>
 14:     <span class='def-Keyword'>def</span> branchName <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>origin/develop</span><span class='def-StringEdge def-String'>'</span>
 15: 
 16:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Configuration?</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 17: 
 18:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 19:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>MINUTES</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 20: 
 21:                 testEnvironment <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 22:                         <span class='def-SymbolStrong def-Symbol'>[</span>
 23:                                 message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Environment Selection</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 24:                                 ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 25:                                 parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 26:                                         choice<span class='def-SymbolStrong def-Symbol'>(</span>
 27:                                                 name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>testEnvironment</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 28:                                                 choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${testEnvironment}</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>stage</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
 29:                                                 description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select an environment</span><span class='def-StringEdge def-String'>'</span>
 30:                                         <span class='def-SymbolStrong def-Symbol'>)</span>
 31:                                 <span class='def-SymbolStrong def-Symbol'>]</span>
 32:                         <span class='def-SymbolStrong def-Symbol'>]</span>
 33:                 <span class='def-SymbolStrong def-Symbol'>)</span>
 34: 
 35:                 collectionName <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 36:                         <span class='def-SymbolStrong def-Symbol'>[</span>
 37:                                 message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Collection Selection</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 38:                                 ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 39:                                 parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 40:                                         choice<span class='def-SymbolStrong def-Symbol'>(</span>
 41:                                                 name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Collection</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 42:                                                 choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${collectionName}</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>regression</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
 43:                                                 description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select a service to test</span><span class='def-StringEdge def-String'>'</span>
 44:                                         <span class='def-SymbolStrong def-Symbol'>)</span>
 45:                                 <span class='def-SymbolStrong def-Symbol'>]</span>
 46:                         <span class='def-SymbolStrong def-Symbol'>]</span>
 47:                 <span class='def-SymbolStrong def-Symbol'>)</span>
 48: 
 49:             <span class='def-SymbolStrong def-Symbol'>}</span>
 50: 
 51:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 52:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>----------------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
 53:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>No User response, switching to default branch '</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span>
 54:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>----------------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
 55:         <span class='def-SymbolStrong def-Symbol'>}</span>
 56: 
 57:     <span class='def-SymbolStrong def-Symbol'>}</span>
 58: 
 59:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Checkout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 60:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>checkout</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>                           <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GitSCM</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 61:                   branches                         <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>*/master</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 62:                   doGenerateSubmoduleConfigurations<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
 63:                   extensions                       <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>CleanCheckout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 64:                   submoduleCfg                     <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 65:                   userRemoteConfigs                <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>credentialsId<span class='def-Symbol'>:</span> DEFAULT_ADMIN_JENKINS_USER_ID<span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> DEFAULT_PROJECT_URL<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
 66:         <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
 67:     <span class='def-SymbolStrong def-Symbol'>}</span>
 68: 
 69:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Branch?</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 70: 
 71:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 72: 
 73:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>60</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SECONDS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 74: 
 75:                 <span class='def-Keyword'>def</span> branchNames <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span><span class='def-SymbolStrong def-Symbol'>(</span>
 76:                         script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>git branch -r</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 77:                         returnStdout<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span>
 78:                 <span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 79: 
 80:                 branchName <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 81:                         <span class='def-SymbolStrong def-Symbol'>[</span>
 82:                                 message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Branch</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 83:                                 ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 84:                                 parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 85:                                         choice<span class='def-SymbolStrong def-Symbol'>(</span>
 86:                                                 name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>branchName</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 87:                                                 choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${branchNames}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
 88:                                                 description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select a branch</span><span class='def-StringEdge def-String'>'</span>
 89:                                         <span class='def-SymbolStrong def-Symbol'>)</span>
 90:                                 <span class='def-SymbolStrong def-Symbol'>]</span>
 91:                         <span class='def-SymbolStrong def-Symbol'>]</span>
 92:                 <span class='def-SymbolStrong def-Symbol'>)</span>
 93:                 branchName<span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 94:             <span class='def-SymbolStrong def-Symbol'>}</span>
 95: 
 96:             <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>branchName <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>none</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 97:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>error</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Invalid selection(s)</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
 98:             <span class='def-SymbolStrong def-Symbol'>}</span>
 99: 
100:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
101:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
102:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>No User response, defaulting to '</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-String'>' branch</span><span class='def-StringEdge def-String'>"</span>
103:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
104:         <span class='def-SymbolStrong def-Symbol'>}</span>
105: 
106:         collectionName <span class='def-Symbol'>=</span> collectionName<span class='def-Symbol'>.</span>toLowerCase<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
107: 
108:     <span class='def-SymbolStrong def-Symbol'>}</span>
109: 
110:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Verify</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
111:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span><span class='def-SymbolStrong def-Symbol'>(</span>
112:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Branch Name</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
113:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Selected Branch Name '</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span>
114:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
115:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Environment?</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
116:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Building for '</span><span class='def-VarStrong def-Var'>${testEnvironment}</span><span class='def-String'>' Environment</span><span class='def-StringEdge def-String'>"</span>
117:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
118:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Collection to Test?</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
119:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Testing '</span><span class='def-VarStrong def-Var'>${collectionName}</span><span class='def-String'>' Collection</span><span class='def-StringEdge def-String'>"</span>
120:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
121:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Gather Tester Info</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
122:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
123:                         jenkinsUser <span class='def-Symbol'>=</span> currentBuild<span class='def-Symbol'>.</span>rawBuild<span class='def-Symbol'>.</span>getCause<span class='def-SymbolStrong def-Symbol'>(</span>Cause<span class='def-Symbol'>.</span>UserIdCause<span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>.</span>getUserId<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
124:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
125:                         jenkinsUser <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>JenkinsSystem</span><span class='def-StringEdge def-String'>'</span>
126:                     <span class='def-SymbolStrong def-Symbol'>}</span>
127:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Running as Tester '</span><span class='def-VarStrong def-Var'>${jenkinsUser}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span>
128:                 <span class='def-SymbolStrong def-Symbol'>}</span>
129:         <span class='def-SymbolStrong def-Symbol'>)</span>
130:     <span class='def-SymbolStrong def-Symbol'>}</span>
131: 
132:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Checkout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
133:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>checkout</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>                           <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GitSCM</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
134:                   branches                         <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
135:                   doGenerateSubmoduleConfigurations<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
136:                   extensions                       <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>CleanCheckout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
137:                   submoduleCfg                     <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
138:                   userRemoteConfigs                <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>credentialsId<span class='def-Symbol'>:</span> DEFAULT_ADMIN_JENKINS_USER_ID<span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> DEFAULT_PROJECT_URL<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
139:         <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
140:     <span class='def-SymbolStrong def-Symbol'>}</span>
141: 
142:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Run Tests</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
143:         currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span>
144:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
145:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>20</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>MINUTES</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
146: 
147:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>npm install newman</span><span class='def-StringEdge def-String'>'</span>
148:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>npm install newman-reporter-html</span><span class='def-StringEdge def-String'>'</span>
149: 
150:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>node_modules/newman/bin</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
151:                     <span class='def-Keyword'>int</span> currentResult <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>./newman.js run '</span><span class='def-VarStrong def-Var'>${env.WORKSPACE}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${COLLECTIONS_PATH}</span><span class='def-String'>/collections/</span><span class='def-VarStrong def-Var'>${collectionName}</span><span class='def-String'>.collection.json' </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
152:                             <span class='def-StringEdge def-String'>"</span><span class='def-String'>-e '</span><span class='def-VarStrong def-Var'>${env.WORKSPACE}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${COLLECTIONS_PATH}</span><span class='def-String'>/environments/</span><span class='def-VarStrong def-Var'>${testEnvironment}</span><span class='def-String'>.environment.json' </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
153:                             <span class='def-StringEdge def-String'>"</span><span class='def-String'>-g '</span><span class='def-VarStrong def-Var'>${env.WORKSPACE}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${COLLECTIONS_PATH}</span><span class='def-String'>/environments/</span><span class='def-VarStrong def-Var'>${GLOBALS_ENVIRONMENT_FILE}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> returnStatus<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span>
154:                     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>currentResult <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
155:                         currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UNSTABLE</span><span class='def-StringEdge def-String'>'</span>
156:                         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Test failed - </span><span class='def-VarStrong def-Var'>${file}</span><span class='def-StringEdge def-String'>"</span>
157:                     <span class='def-SymbolStrong def-Symbol'>}</span>
158:                 <span class='def-SymbolStrong def-Symbol'>}</span>
159:             <span class='def-SymbolStrong def-Symbol'>}</span>
160:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>FlowInterruptedException interruptEx<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
161:             currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ABORTED</span><span class='def-StringEdge def-String'>'</span>
162:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
163:             currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UNSTABLE</span><span class='def-StringEdge def-String'>'</span>
164:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Test Execution Timed Out</span><span class='def-StringEdge def-String'>'</span>
165:         <span class='def-SymbolStrong def-Symbol'>}</span>
166:     <span class='def-SymbolStrong def-Symbol'>}</span>
167: 
168:     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ABORTED</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
169: 
170:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Publish Reports</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
171:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span><span class='def-SymbolStrong def-Symbol'>(</span>
172:                     <span class='def-StringEdge def-String'>"</span><span class='def-String'>Email</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
173:                         sendEmailNotification<span class='def-SymbolStrong def-Symbol'>(</span>branchName<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> currentBuild<span class='def-Symbol'>.</span>result<span class='def-SymbolStrong def-Symbol'>)</span>
174:                     <span class='def-SymbolStrong def-Symbol'>}</span>
175:             <span class='def-SymbolStrong def-Symbol'>)</span>
176:         <span class='def-SymbolStrong def-Symbol'>}</span>
177: 
178:     <span class='def-SymbolStrong def-Symbol'>}</span>
179: 
180: <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
181: 
182: <span class='def-Comment def-Syntax'>/**</span>
183: <span class='def-Comment def-Syntax'> * Send an email based on runtime settings.</span>
184: <span class='def-Comment def-Syntax'> *</span>
185: <span class='def-Comment def-Syntax'> * @param testEnvironment test environment used</span>
186: <span class='def-Comment def-Syntax'> *  * @param branch branch selected</span>
187: <span class='def-Comment def-Syntax'> * @param currentResult current test build result</span>
188: <span class='def-Comment def-Syntax'> */</span>
189: <span class='def-Keyword'>private</span> <span class='def-Keyword'>void</span> sendEmailNotification<span class='def-SymbolStrong def-Symbol'>(</span>branchName<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> currentResult<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
190: 
191:     <span class='def-Keyword'>def</span> subject <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${currentResult}</span><span class='def-String'> :: Newman Api Tests</span><span class='def-StringEdge def-String'>"</span>
192:     <span class='def-Keyword'>def</span> body <span class='def-Symbol'>=</span> getBody<span class='def-SymbolStrong def-Symbol'>(</span>currentResult<span class='def-Symbol'>,</span> branchName<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> BUILD_NUMBER<span class='def-Symbol'>,</span> BUILD_TIMESTAMP<span class='def-Symbol'>,</span> env<span class='def-Symbol'>.</span>BUILD_URL<span class='def-SymbolStrong def-Symbol'>)</span>
193:     emailext<span class='def-SymbolStrong def-Symbol'>(</span>
194:             recipientProviders<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
195:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>DevelopersRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
196:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>CulpritsRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
197:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>RequesterRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
198:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>FailingTestSuspectsRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
199:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>FirstFailingBuildSuspectsRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
200:                     <span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UpstreamComitterRecipientProvider</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span>
201:             <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
202:             attachLog<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
203:             subject<span class='def-Symbol'>:</span> subject<span class='def-Symbol'>,</span>
204:             body<span class='def-Symbol'>:</span> body<span class='def-Symbol'>,</span>
205:             attachmentsPattern<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/target/failsafe-reports/testng-native-results/emailable-report.html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
206:             to<span class='def-Symbol'>:</span> DEFAULT_EMAIL<span class='def-Symbol'>,</span>
207:             mimeType<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>text/html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
208:             replyTo<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>DEFAULT_REPLYTO
209:     <span class='def-SymbolStrong def-Symbol'>)</span>
210: <span class='def-SymbolStrong def-Symbol'>}</span>
211: 
212: <span class='def-Comment def-Syntax'>/**</span>
213: <span class='def-Comment def-Syntax'> *</span>
214: <span class='def-Comment def-Syntax'> *  Create beautified HTML based report</span>
215: <span class='def-Comment def-Syntax'> *</span>
216: <span class='def-Comment def-Syntax'> * @param result current build result</span>
217: <span class='def-Comment def-Syntax'> * @param branch branch selected</span>
218: <span class='def-Comment def-Syntax'> * @param testEnvironment test environment used</span>
219: <span class='def-Comment def-Syntax'> * @param buildNumber jenkins build number</span>
220: <span class='def-Comment def-Syntax'> * @param buildTime build timestamp</span>
221: <span class='def-Comment def-Syntax'> * @param buildUrl build url</span>
222: <span class='def-Comment def-Syntax'> * @return HTML report</span>
223: <span class='def-Comment def-Syntax'> */</span>
224: <span class='def-Keyword'>static</span> <span class='def-FunctionKeyword def-Keyword'>String</span> getBody<span class='def-SymbolStrong def-Symbol'>(</span>result<span class='def-Symbol'>,</span> branch<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> buildNumber<span class='def-Symbol'>,</span> buildTime<span class='def-Symbol'>,</span> buildUrl<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
225: 
226:     <span class='def-FunctionKeyword def-Keyword'>String</span> emailBody <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;!DOCTYPE html>&lt;html lang='en'></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
227:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;head>&lt;meta charset='UTF-8'>&lt;style>table {margin-bottom: 40px;}table thead th {padding-right:60px; white-space: nowrap;} table tbody td.content {vertical-align:top;}&lt;/style>&lt;/head></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
228:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;body>&lt;table>&lt;thead></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
229:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;th>Result&lt;/th>&lt;th>Branch&lt;/th>&lt;th>Environment&lt;/th>&lt;th>Build #&lt;/th>&lt;th>Build Time&lt;/th></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
230:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;/thead>&lt;tbody>&lt;tr></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
231:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'>&lt;a href='</span><span class='def-VarStrong def-Var'>${buildUrl}</span><span class='def-String'>allure' target='_blank'></span><span class='def-VarStrong def-Var'>${result}</span><span class='def-String'>&lt;/a>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
232:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${branch}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
233:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${testEnvironment}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
234:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'>&lt;a href='</span><span class='def-VarStrong def-Var'>${buildUrl}</span><span class='def-String'>console' target='_blank'></span><span class='def-VarStrong def-Var'>${buildNumber}</span><span class='def-String'>&lt;/a>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
235:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${buildTime}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
236:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;/tr>&lt;/tbody>&lt;/table>&lt;/body>&lt;/html></span><span class='def-StringEdge def-String'>"</span>
237:     <span class='def-Keyword'>return</span> emailBody
238: <span class='def-SymbolStrong def-Symbol'>}</span>
