  0: <span class='def-Comment def-Syntax'>#!</span><span class='def-VarStrong def-Var'>groovy</span>
  1: 
  2: DEFAULT_EMAIL <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>anthonyl22@gmail.com</span><span class='def-StringEdge def-String'>'</span>
  3: <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>node</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
  4: 
  5:     <span class='def-Keyword'>def</span> BITBUCKET_CREDENTIALS_ID <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>sample</span><span class='def-StringEdge def-String'>'</span>
  6:     <span class='def-Keyword'>def</span> BITBUCKET_SOURCE_PROJECT <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ssh://sample.git</span><span class='def-StringEdge def-String'>'</span>
  7:     <span class='def-Keyword'>def</span> INTERNAL_SELENIUM_GRID_URL <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>http://MY_SELENIUM_GRID.com:4444</span><span class='def-StringEdge def-String'>'</span>
  8: 
  9:     <span class='def-Keyword'>def</span> mavenProfileToRun <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>smoke</span><span class='def-StringEdge def-String'>'</span>
 10:     <span class='def-Keyword'>def</span> numberOfUsers <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>5</span><span class='def-StringEdge def-String'>'</span>
 11:     <span class='def-Keyword'>def</span> DEFAULT_BRANCH_NAME <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>origin/develop</span><span class='def-StringEdge def-String'>'</span>
 12:     <span class='def-Keyword'>def</span> branchName
 13:     <span class='def-Keyword'>boolean</span> hasFailed <span class='def-Symbol'>=</span> <span class='def-Keyword'>false</span>
 14:     <span class='def-Keyword'>def</span> grid <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Sauce Labs</span><span class='def-StringEdge def-String'>'</span>
 15: 
 16:     <span class='def-Keyword'>def</span> MAVEN_VERSION <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Maven 3.3.9</span><span class='def-StringEdge def-String'>'</span>
 17:     <span class='def-Keyword'>def</span> mvnHome <span class='def-Symbol'>=</span> tool name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${MAVEN_VERSION}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> type<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>maven</span><span class='def-StringEdge def-String'>'</span>
 18:     <span class='def-Keyword'>def</span> Test_Environment
 19: 
 20:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Configuration?</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 21: 
 22:         <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-Keyword'>null</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> params<span class='def-Symbol'>.</span>Test_Environment<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 23: 
 24:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>No Properties found from Upstream Job</span><span class='def-StringEdge def-String'>'</span>
 25:             Test_Environment <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 26:                     <span class='def-SymbolStrong def-Symbol'>[</span>
 27:                             message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Environment Selection</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 28:                             ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 29:                             parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 30:                                     choice<span class='def-SymbolStrong def-Symbol'>(</span>
 31:                                             name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Test_Environment</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 32:                                             choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>stage</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>dev</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>test</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>preprod</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>prod</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
 33:                                             description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select an environment</span><span class='def-StringEdge def-String'>'</span>
 34:                                     <span class='def-SymbolStrong def-Symbol'>)</span>
 35:                             <span class='def-SymbolStrong def-Symbol'>]</span>
 36:                     <span class='def-SymbolStrong def-Symbol'>]</span>
 37:             <span class='def-SymbolStrong def-Symbol'>)</span>
 38: 
 39:             numberOfUsers <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 40:                     <span class='def-SymbolStrong def-Symbol'>[</span>
 41:                             message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Number of Users</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 42:                             ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 43:                             parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 44:                                     choice<span class='def-SymbolStrong def-Symbol'>(</span>
 45:                                             name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>numberOfUsers</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 46:                                             choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${numberOfUsers}</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>1</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>3</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>10</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>15</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>20</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
 47:                                             description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select number of users</span><span class='def-StringEdge def-String'>'</span>
 48:                                     <span class='def-SymbolStrong def-Symbol'>)</span>
 49:                             <span class='def-SymbolStrong def-Symbol'>]</span>
 50:                     <span class='def-SymbolStrong def-Symbol'>]</span>
 51:             <span class='def-SymbolStrong def-Symbol'>)</span>
 52: 
 53:             <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 54:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>20</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SECONDS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 55:                     grid <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span> message<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GRID Selection</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 56:                             parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>
 57:                                                  <span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>      <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>ChoiceParameter</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 58:                                                  choiceType  <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>PT_RADIO</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 59:                                                  description <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select an runtime grid</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 60:                                                  filterLength<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>,</span>
 61:                                                  filterable  <span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
 62:                                                  name        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>grid</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 63:                                                  script      <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
 64:                                                          <span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GroovyScript</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 65:                                                          fallbackScript<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>classpath<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span> sandbox<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span> script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 66:                                                          script        <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>classpath<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 67:                                                                           sandbox  <span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span><span class='def-Symbol'>,</span>
 68:                                                                           script   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>return['Selenium Grid','</span><span class='def-VarStrong def-Var'>${grid}</span><span class='def-String'>']</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span>
 69:                                                  <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
 70:                 <span class='def-SymbolStrong def-Symbol'>}</span>
 71:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>Exception e<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 72:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Selecting default 'Sauce Labs' grid setting</span><span class='def-StringEdge def-String'>"</span>
 73:             <span class='def-SymbolStrong def-Symbol'>}</span>
 74: 
 75:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Checkout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 76:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>checkout</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>                           <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GitSCM</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 77:                           branches                         <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>*/master</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 78:                           doGenerateSubmoduleConfigurations<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
 79:                           extensions                       <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>CleanCheckout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 80:                           submoduleCfg                     <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
 81:                           userRemoteConfigs                <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>credentialsId<span class='def-Symbol'>:</span> BITBUCKET_CREDENTIALS_ID<span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> BITBUCKET_SOURCE_PROJECT<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
 82:                 <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
 83:             <span class='def-SymbolStrong def-Symbol'>}</span>
 84: 
 85:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Branch?</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 86: 
 87:                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 88: 
 89:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>MINUTES</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 90: 
 91:                         <span class='def-Keyword'>def</span> branchNames <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span><span class='def-SymbolStrong def-Symbol'>(</span>
 92:                                 script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>git branch -r</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 93:                                 returnStdout<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span>
 94:                         <span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 95: 
 96:                         branchName <span class='def-Symbol'>=</span> <span class='jenkinsfile-ConditionMethod def-InterfaceKeyword def-Keyword'>input</span><span class='def-SymbolStrong def-Symbol'>(</span>
 97:                                 <span class='def-SymbolStrong def-Symbol'>[</span>
 98:                                         message   <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Branch</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
 99:                                         ok        <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>OK</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
100:                                         parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>
101:                                                 choice<span class='def-SymbolStrong def-Symbol'>(</span>
102:                                                         name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>branchName</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
103:                                                         choices<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${branchNames}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
104:                                                         description<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Please select a branch</span><span class='def-StringEdge def-String'>'</span>
105:                                                 <span class='def-SymbolStrong def-Symbol'>)</span>
106:                                         <span class='def-SymbolStrong def-Symbol'>]</span>
107:                                 <span class='def-SymbolStrong def-Symbol'>]</span>
108:                         <span class='def-SymbolStrong def-Symbol'>)</span>
109:                         branchName<span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
110:                     <span class='def-SymbolStrong def-Symbol'>}</span>
111: 
112:                     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>branchName <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>none</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
113:                         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>error</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Invalid selection(s)</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
114:                     <span class='def-SymbolStrong def-Symbol'>}</span>
115: 
116:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
117:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
118:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>No User response, switching to default branch '</span><span class='def-VarStrong def-Var'>${DEFAULT_BRANCH_NAME}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span>
119:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>------------------------------------------------------</span><span class='def-StringEdge def-String'>"</span>
120:                 <span class='def-SymbolStrong def-Symbol'>}</span>
121: 
122:             <span class='def-SymbolStrong def-Symbol'>}</span>
123: 
124:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
125:             <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${params.Test_Environment}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>.</span>contains<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>test</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-Symbol'>|</span><span class='def-Symbol'>|</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${params.Test_Environment}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>.</span>contains<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>qa</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
126:                 Test_Environment <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>test</span><span class='def-StringEdge def-String'>'</span>
127:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${params.Test_Environment}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>.</span>contains<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>stage</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
128:                 Test_Environment <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>stage</span><span class='def-StringEdge def-String'>'</span>
129:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${params.Test_Environment}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>.</span>contains<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>prod</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
130:                 Test_Environment <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>prod</span><span class='def-StringEdge def-String'>'</span>
131:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
132:                 Test_Environment <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${params.Test_Environment}</span><span class='def-StringEdge def-String'>"</span>
133:             <span class='def-SymbolStrong def-Symbol'>}</span>
134: 
135:             branchName <span class='def-Symbol'>=</span> DEFAULT_BRANCH_NAME
136:         <span class='def-SymbolStrong def-Symbol'>}</span>
137: 
138:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Current test.env=</span><span class='def-VarStrong def-Var'>${Test_Environment}</span><span class='def-String'> Selected</span><span class='def-StringEdge def-String'>"</span>
139:         mavenProfileToRun <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${mavenProfileToRun}</span><span class='def-String'>-</span><span class='def-VarStrong def-Var'>${brand}</span><span class='def-StringEdge def-String'>"</span>
140: 
141:     <span class='def-SymbolStrong def-Symbol'>}</span>
142: 
143:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Verify</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
144:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span><span class='def-SymbolStrong def-Symbol'>(</span>
145:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Branch Name</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
146:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Selected Branch Name '</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-String'>'</span><span class='def-StringEdge def-String'>"</span>
147:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
148:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Environment</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
149:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Testing '</span><span class='def-VarStrong def-Var'>${Test_Environment}</span><span class='def-String'>' Environment</span><span class='def-StringEdge def-String'>"</span>
150:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
151:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Maven Profile?</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
152:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Running Maven Profile '</span><span class='def-VarStrong def-Var'>${mavenProfileToRun}</span><span class='def-String'>' </span><span class='def-StringEdge def-String'>"</span>
153:                 <span class='def-SymbolStrong def-Symbol'>}</span>
154:         <span class='def-SymbolStrong def-Symbol'>)</span>
155:     <span class='def-SymbolStrong def-Symbol'>}</span>
156: 
157:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Checkout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
158:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>checkout</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span>                           <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GitSCM</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
159:                   branches                         <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${branchName}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
160:                   doGenerateSubmoduleConfigurations<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
161:                   extensions                       <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>CleanCheckout</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
162:                   submoduleCfg                     <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span>
163:                   userRemoteConfigs                <span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>credentialsId<span class='def-Symbol'>:</span> BITBUCKET_CREDENTIALS_ID<span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> BITBUCKET_SOURCE_PROJECT<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
164:         <span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
165:     <span class='def-SymbolStrong def-Symbol'>}</span>
166: 
167:     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>grid<span class='def-Symbol'>.</span>contains<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Selenium</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
168:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Modify Runtime Grid</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
169:             <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
170:                 HashMap<span class='def-Symbol'>&lt;</span><span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>,</span> <span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>></span> gridProperties <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>readProperties</span><span class='def-SymbolStrong def-Symbol'>(</span>file<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>WORKSPACE <span class='def-Symbol'>+</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>/src/test/resources/config/</span><span class='def-VarStrong def-Var'>${TEST_ENVIRONMENT}</span><span class='def-String'>/grid.properties</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
171:                 gridProperties<span class='def-Symbol'>.</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>grid.hub.url</span><span class='def-StringEdge def-String'>'</span> <span class='def-Symbol'>=</span> INTERNAL_SELENIUM_GRID_URL
172:                 <span class='def-Keyword'>def</span> gridPropsString <span class='def-Symbol'>=</span> gridProperties<span class='def-Symbol'>.</span>
173:                         collect <span class='def-SymbolStrong def-Symbol'>{</span> k<span class='def-Symbol'>,</span> v <span class='def-Symbol'>-</span><span class='def-Symbol'>></span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>$k</span><span class='def-String'>=</span><span class='def-VarStrong def-Var'>$v</span><span class='def-StringEdge def-String'>"</span> <span class='def-SymbolStrong def-Symbol'>}</span>
174:                         <span class='def-Symbol'>.</span>join<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
175:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>writeFile</span> file<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>WORKSPACE <span class='def-Symbol'>+</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>/src/test/resources/config/</span><span class='def-VarStrong def-Var'>${TEST_ENVIRONMENT}</span><span class='def-String'>/grid.properties</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> text<span class='def-Symbol'>:</span> gridPropsString
176: 
177:                 HashMap<span class='def-Symbol'>&lt;</span><span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>,</span> <span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>></span> automationProperties <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>readProperties</span><span class='def-SymbolStrong def-Symbol'>(</span>file<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>WORKSPACE <span class='def-Symbol'>+</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>/src/test/resources/config/</span><span class='def-VarStrong def-Var'>${TEST_ENVIRONMENT}</span><span class='def-String'>/automation.properties</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
178:                 automationProperties<span class='def-Symbol'>.</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>saucelabs.accesskey</span><span class='def-StringEdge def-String'>'</span> <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-StringEdge def-String'>'</span>
179:                 <span class='def-Keyword'>def</span> automationPropsString <span class='def-Symbol'>=</span> automationProperties<span class='def-Symbol'>.</span>
180:                         collect <span class='def-SymbolStrong def-Symbol'>{</span> k<span class='def-Symbol'>,</span> v <span class='def-Symbol'>-</span><span class='def-Symbol'>></span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>$k</span><span class='def-String'>=</span><span class='def-VarStrong def-Var'>$v</span><span class='def-StringEdge def-String'>"</span> <span class='def-SymbolStrong def-Symbol'>}</span>
181:                         <span class='def-Symbol'>.</span>join<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
182:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>writeFile</span> file<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>WORKSPACE <span class='def-Symbol'>+</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>/src/test/resources/config/</span><span class='def-VarStrong def-Var'>${TEST_ENVIRONMENT}</span><span class='def-String'>/automation.properties</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> text<span class='def-Symbol'>:</span> automationPropsString
183:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>Exception ex<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
184:                 <span class='def-FunctionKeyword def-Keyword'>println</span> ex<span class='def-Symbol'>.</span>message
185:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>error</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Failed to change runtime grid</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
186:             <span class='def-SymbolStrong def-Symbol'>}</span>
187:         <span class='def-SymbolStrong def-Symbol'>}</span>
188:     <span class='def-SymbolStrong def-Symbol'>}</span>
189: 
190:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Smoke Tests</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
191:         currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span>
192:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
193:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>30</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>MINUTES</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
194:                 <span class='def-Keyword'>int</span> result <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>'</span><span class='def-VarStrong def-Var'>${mvnHome}</span><span class='def-String'>/bin/mvn' install -P</span><span class='def-VarStrong def-Var'>${mavenProfileToRun}</span><span class='def-String'> -Dtest.env=</span><span class='def-VarStrong def-Var'>${Test_Environment}</span><span class='def-String'> -Dbrand=</span><span class='def-VarStrong def-Var'>${brand}</span><span class='def-String'> -Drunners=</span><span class='def-VarStrong def-Var'>${numberOfUsers}</span><span class='def-String'> -U failsafe:verify -f pom.xml</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> returnStatus<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span>
195:                 <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>result <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
196:                     hasFailed <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span>
197:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Test failures</span><span class='def-StringEdge def-String'>"</span>
198:                 <span class='def-SymbolStrong def-Symbol'>}</span>
199:             <span class='def-SymbolStrong def-Symbol'>}</span>
200:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
201:             hasFailed <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span>
202:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Test Execution Timed Out</span><span class='def-StringEdge def-String'>'</span>
203:         <span class='def-SymbolStrong def-Symbol'>}</span>
204:     <span class='def-SymbolStrong def-Symbol'>}</span>
205: 
206:     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>hasFailed<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
207:         currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span>
208:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Rerun Failed</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
209:             <span class='def-Keyword'>def</span> fileToFind <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${WORKSPACE}</span><span class='def-String'>/target/failsafe-reports/testng-failed.xml</span><span class='def-StringEdge def-String'>"</span>
210:             exists <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>fileExists</span> fileToFind
211:             <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>exists<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
212:                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
213:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>timeout</span><span class='def-SymbolStrong def-Symbol'>(</span>time<span class='def-Symbol'>:</span> <span class='def-NumberDec def-Number'>30</span><span class='def-Symbol'>,</span> unit<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>MINUTES</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
214:                         <span class='def-Keyword'>int</span> result <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>'</span><span class='def-VarStrong def-Var'>${mvnHome}</span><span class='def-String'>/bin/mvn' install -Prerun-failed -Dtest.env=</span><span class='def-VarStrong def-Var'>${Test_Environment}</span><span class='def-String'> -Dbrand=</span><span class='def-VarStrong def-Var'>${brand}</span><span class='def-String'> -Drunners=</span><span class='def-VarStrong def-Var'>${numberOfUsers}</span><span class='def-String'> -Dfindbugs.skip=true failsafe:verify -f pom.xml</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> returnStatus<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span>
215:                         <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>result <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
216:                             currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>FAILURE</span><span class='def-StringEdge def-String'>'</span>
217:                             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Rerun Test failures</span><span class='def-StringEdge def-String'>"</span>
218:                         <span class='def-SymbolStrong def-Symbol'>}</span>
219:                     <span class='def-SymbolStrong def-Symbol'>}</span>
220:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
221:                     currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UNSTABLE</span><span class='def-StringEdge def-String'>'</span>
222:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Test Execution Timed Out</span><span class='def-StringEdge def-String'>'</span>
223:                 <span class='def-SymbolStrong def-Symbol'>}</span>
224:             <span class='def-SymbolStrong def-Symbol'>}</span>
225:         <span class='def-SymbolStrong def-Symbol'>}</span>
226:     <span class='def-SymbolStrong def-Symbol'>}</span>
227: 
228:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Publish Reports</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
229:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span><span class='def-SymbolStrong def-Symbol'>(</span>
230:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Allure</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
231:                     allure includeProperties<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
232:                             results<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-SymbolStrong def-Symbol'>[</span>path<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>target/allure-results</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>]</span>
233:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
234:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>TestNG</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
235:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>publishHTML</span><span class='def-SymbolStrong def-Symbol'>(</span>
236:                             <span class='def-SymbolStrong def-Symbol'>[</span>allowMissing         <span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span><span class='def-Symbol'>,</span>
237:                              alwaysLinkToLastBuild<span class='def-Symbol'>:</span> <span class='def-Keyword'>true</span><span class='def-Symbol'>,</span>
238:                              keepAll              <span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
239:                              reportDir            <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/target/failsafe-reports/**/testng-results.xml</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
240:                              reportFiles          <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>index.html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
241:                              reportName           <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Automation Report</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
242:                              reportTitles         <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Automation Report</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
243:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
244:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Junit</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
245:                     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>step</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='jenkinsfile-Constant def-Constant def-Keyword'>$class</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>JUnitResultArchiver</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> testResults<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/target/surefire-reports/*.xml</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> healthScaleFactor<span class='def-Symbol'>:</span> <span class='def-NumberFloat def-Number'>1.0</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span>
246:                 <span class='def-SymbolStrong def-Symbol'>}</span><span class='def-Symbol'>,</span>
247:                 <span class='def-StringEdge def-String'>"</span><span class='def-String'>Email</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>{</span>
248:                     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
249:                         sendEmailNotification<span class='def-SymbolStrong def-Symbol'>(</span>branchName<span class='def-Symbol'>,</span> Test_Environment<span class='def-Symbol'>,</span> brand<span class='def-Symbol'>,</span> currentBuild<span class='def-Symbol'>.</span>result<span class='def-SymbolStrong def-Symbol'>)</span>
250:                     <span class='def-SymbolStrong def-Symbol'>}</span>
251:                 <span class='def-SymbolStrong def-Symbol'>}</span>
252:         <span class='def-SymbolStrong def-Symbol'>)</span>
253:     <span class='def-SymbolStrong def-Symbol'>}</span>
254: 
255:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Sonar</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
256: 
257:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
258:             withSonarQubeEnv<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>sonarqube</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
259:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> script<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>'</span><span class='def-VarStrong def-Var'>${mvnHome}</span><span class='def-String'>/bin/mvn' sonar:sonar -Dsonar.branch.name=develop -f pom.xml</span><span class='def-StringEdge def-String'>"</span>
260:             <span class='def-SymbolStrong def-Symbol'>}</span>
261:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>Exception e<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
262:             <span class='def-FunctionKeyword def-Keyword'>println</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Temporarily ignoring an error while invoking Sonar logic: </span><span class='def-VarStrong def-Var'>${e.message}</span><span class='def-StringEdge def-String'>"</span>
263:         <span class='def-SymbolStrong def-Symbol'>}</span>
264:     <span class='def-SymbolStrong def-Symbol'>}</span>
265: 
266:     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>build</span> job<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>downstream-job-name</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
267:             propagate<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
268:             wait<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
269:             parameters<span class='def-Symbol'>:</span> <span class='def-SymbolStrong def-Symbol'>[</span>string<span class='def-SymbolStrong def-Symbol'>(</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Test_Environment</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> value<span class='def-Symbol'>:</span> <span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>.</span>valueOf<span class='def-SymbolStrong def-Symbol'>(</span>Test_Environment<span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>,</span>
270:                          string<span class='def-SymbolStrong def-Symbol'>(</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>brand</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> value<span class='def-Symbol'>:</span> <span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>.</span>valueOf<span class='def-SymbolStrong def-Symbol'>(</span>brand<span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>,</span>
271:                          string<span class='def-SymbolStrong def-Symbol'>(</span>name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>branchName</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> value<span class='def-Symbol'>:</span> <span class='def-FunctionKeyword def-Keyword'>String</span><span class='def-Symbol'>.</span>valueOf<span class='def-SymbolStrong def-Symbol'>(</span>branchName<span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>]</span>
272: 
273: <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
274: 
275: <span class='def-Comment def-Syntax'>/**</span>
276: <span class='def-Comment def-Syntax'> * Send an email based on runtime settings.</span>
277: <span class='def-Comment def-Syntax'> *</span>
278: <span class='def-Comment def-Syntax'> * @param testEnvironment test environment used</span>
279: <span class='def-Comment def-Syntax'> * @param branch branch selected</span>
280: <span class='def-Comment def-Syntax'> * @param brand brand to be tested</span>
281: <span class='def-Comment def-Syntax'> * @param currentResult current test build result</span>
282: <span class='def-Comment def-Syntax'> */</span>
283: <span class='def-Keyword'>private</span> <span class='def-Keyword'>void</span> sendEmailNotification<span class='def-SymbolStrong def-Symbol'>(</span>branchName<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> brand<span class='def-Symbol'>,</span> currentResult<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
284: 
285:     <span class='def-Keyword'>def</span> subject <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${currentResult}</span><span class='def-String'> :: Smoke Tests</span><span class='def-StringEdge def-String'>"</span>
286:     <span class='def-Keyword'>def</span> body <span class='def-Symbol'>=</span> getBody<span class='def-SymbolStrong def-Symbol'>(</span>currentResult<span class='def-Symbol'>,</span> branchName<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> brand<span class='def-Symbol'>,</span> BUILD_NUMBER<span class='def-Symbol'>,</span> BUILD_TIMESTAMP<span class='def-Symbol'>,</span> env<span class='def-Symbol'>.</span>BUILD_URL<span class='def-SymbolStrong def-Symbol'>)</span>
287:     emailext<span class='def-SymbolStrong def-Symbol'>(</span>
288:             attachLog<span class='def-Symbol'>:</span> <span class='def-Keyword'>false</span><span class='def-Symbol'>,</span>
289:             subject<span class='def-Symbol'>:</span> subject<span class='def-Symbol'>,</span>
290:             body<span class='def-Symbol'>:</span> body<span class='def-Symbol'>,</span>
291:             attachmentsPattern<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/target/failsafe-reports/emailable-report.html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
292:             to<span class='def-Symbol'>:</span> DEFAULT_EMAIL<span class='def-Symbol'>,</span>
293:             mimeType<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>text/html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
294:             replyTo<span class='def-Symbol'>:</span> env<span class='def-Symbol'>.</span>DEFAULT_REPLYTO
295:     <span class='def-SymbolStrong def-Symbol'>)</span>
296: <span class='def-SymbolStrong def-Symbol'>}</span>
297: 
298: <span class='def-Comment def-Syntax'>/**</span>
299: <span class='def-Comment def-Syntax'> *</span>
300: <span class='def-Comment def-Syntax'> *  Create beautified HTML based report</span>
301: <span class='def-Comment def-Syntax'> *</span>
302: <span class='def-Comment def-Syntax'> * @param result current build result</span>
303: <span class='def-Comment def-Syntax'> * @param branch branch selected</span>
304: <span class='def-Comment def-Syntax'> * @param testEnvironment test environment used</span>
305: <span class='def-Comment def-Syntax'> * @param brand brand tested</span>
306: <span class='def-Comment def-Syntax'> * @param buildNumber jenkins build number</span>
307: <span class='def-Comment def-Syntax'> * @param buildTime build timestamp</span>
308: <span class='def-Comment def-Syntax'> * @param buildUrl build url</span>
309: <span class='def-Comment def-Syntax'> * @return HTML report</span>
310: <span class='def-Comment def-Syntax'> */</span>
311: <span class='def-Keyword'>static</span> <span class='def-FunctionKeyword def-Keyword'>String</span> getBody<span class='def-SymbolStrong def-Symbol'>(</span>result<span class='def-Symbol'>,</span> branch<span class='def-Symbol'>,</span> testEnvironment<span class='def-Symbol'>,</span> brand<span class='def-Symbol'>,</span> buildNumber<span class='def-Symbol'>,</span> buildTime<span class='def-Symbol'>,</span> buildUrl<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
312: 
313:     <span class='def-FunctionKeyword def-Keyword'>String</span> emailBody <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;!DOCTYPE html>&lt;html lang='en'></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
314:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;head>&lt;meta charset='UTF-8'>&lt;style>table {margin-bottom: 40px;}table thead th {padding-right:60px; white-space: nowrap;} table tbody td.content {vertical-align:top;}&lt;/style>&lt;/head></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
315:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;body>&lt;table>&lt;thead></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
316:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;th>Result&lt;/th>&lt;th>Branch&lt;/th>&lt;th>Environment&lt;/th>&lt;th>Brand&lt;/th>&lt;th>Build #&lt;/th>&lt;th>Build Time&lt;/th></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
317:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;/thead>&lt;tbody>&lt;tr></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
318:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'>&lt;a href='</span><span class='def-VarStrong def-Var'>${buildUrl}</span><span class='def-String'>allure' target='_blank'></span><span class='def-VarStrong def-Var'>${result}</span><span class='def-String'>&lt;/a>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
319:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${branch}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
320:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${testEnvironment}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
321:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${brand}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
322:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'>&lt;a href='</span><span class='def-VarStrong def-Var'>${buildUrl}</span><span class='def-String'>console' target='_blank'></span><span class='def-VarStrong def-Var'>${buildNumber}</span><span class='def-String'>&lt;/a>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
323:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;td class='content'></span><span class='def-VarStrong def-Var'>${buildTime}</span><span class='def-String'>&lt;/td></span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
324:             <span class='def-StringEdge def-String'>"</span><span class='def-String'>&lt;/tr>&lt;/tbody>&lt;/table>&lt;/body>&lt;/html></span><span class='def-StringEdge def-String'>"</span>
325:     <span class='def-Keyword'>return</span> emailBody
326: <span class='def-SymbolStrong def-Symbol'>}</span>
327: 
