  0: properties <span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span>
  1: <span class='def-Keyword'>def</span> loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
  2:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>node</span> <span class='def-SymbolStrong def-Symbol'>{</span>
  3:         properties <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>readProperties</span> file<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/config.properties</span><span class='def-StringEdge def-String'>"</span>
  4:     <span class='def-SymbolStrong def-Symbol'>}</span>
  5: <span class='def-SymbolStrong def-Symbol'>}</span>
  6: <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>pipeline</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
  7:     <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>agent</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
  8:         <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>node</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
  9:             <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>label</span> <span class='def-StringEdge def-String'>"</span><span class='def-StringEdge def-String'>"</span>
 10:             <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>customWorkspace</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>/testgrid/testgrid-home/jobs/wso2apim-2.1.0-LTS</span><span class='def-StringEdge def-String'>'</span>
 11:         <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
 12:     <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
 13: 
 14:     <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>environment</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
 15:             <span class='jenkinsfile-Variable def-Var'>CONCURRENT_JOBS</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-NumberDec def-Number'>4</span>
 16:             <span class='jenkinsfile-Variable def-Var'>TESTGRID_NAME</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>WSO2-TestGrid</span><span class='def-StringEdge def-String'>'</span>
 17:             <span class='jenkinsfile-Variable def-Var'>TESTGRID_DIST_LOCATION</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>/testgrid/testgrid-home/testgrid-dist/</span><span class='def-StringEdge def-String'>'</span>
 18:             <span class='jenkinsfile-Variable def-Var'>TESTGRID_HOME</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>/testgrid/testgrid-home/</span><span class='def-StringEdge def-String'>'</span>
 19: 
 20:             <span class='jenkinsfile-Variable def-Var'>PRODUCT</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>wso2apim-2.1.0-LTS</span><span class='def-StringEdge def-String'>"</span>
 21: 
 22:             <span class='jenkinsfile-Variable def-Var'>INFRASTRUCTURE_REPOSITORY</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>https://github.com/azinneera/cloudformation-apim</span><span class='def-StringEdge def-String'>'</span>
 23:             <span class='jenkinsfile-Variable def-Var'>DEPLOYMENT_REPOSITORY</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>https://github.com/azinneera/cloudformation-apim</span><span class='def-StringEdge def-String'>'</span>
 24:             <span class='jenkinsfile-Variable def-Var'>SCENARIOS_REPOSITORY</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>https://github.com/wso2-incubator/apim-test-integration.git</span><span class='def-StringEdge def-String'>'</span>
 25: 
 26:             <span class='jenkinsfile-Variable def-Var'>INFRA_LOCATION</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>workspace/aws-cloudformation-templates</span><span class='def-StringEdge def-String'>"</span>
 27:             <span class='jenkinsfile-Variable def-Var'>DEPLOYMENT_LOCATION</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>workspace/aws-cloudformation-templates</span><span class='def-StringEdge def-String'>"</span>
 28:             <span class='jenkinsfile-Variable def-Var'>SCENARIOS_LOCATION</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>workspace/apim-test-integration</span><span class='def-StringEdge def-String'>"</span>
 29:             <span class='jenkinsfile-Variable def-Var'>INFRA_CONFIGS_LOCATION</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/infrastructure-build-plans</span><span class='def-StringEdge def-String'>"</span>
 30: 
 31:             <span class='jenkinsfile-Variable def-Var'>AWS_ACCESS_KEY_ID</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_ACCESS_KEY_ID</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 32:             <span class='jenkinsfile-Variable def-Var'>AWS_SECRET_ACCESS_KEY</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_SECRET_ACCESS_KEY</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 33:             <span class='jenkinsfile-Variable def-Var'>tomcatUsername</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TOMCAT_USERNAME</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 34:             <span class='jenkinsfile-Variable def-Var'>tomcatPassword</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TOMCAT_PASSWORD</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 35:             <span class='jenkinsfile-Variable def-Var'>PWD</span><span class='jenkinsfile-Symbol def-Symbol'>=</span><span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>pwd</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 36:             <span class='jenkinsfile-Variable def-Var'>JOB_CONFIG_YAML</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>job-config.yaml</span><span class='def-StringEdge def-String'>"</span>
 37:             <span class='jenkinsfile-Variable def-Var'>JOB_CONFIG_YAML_PATH</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
 38: 
 39:     <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
 40: 
 41:     <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>tools</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
 42:         <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>jdk</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>jdk8</span><span class='def-StringEdge def-String'>'</span>
 43:     <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
 44: 
 45:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stages</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 46:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Preparation</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 47:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>steps</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 48:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Preparing TestGrid test-environment</span><span class='def-StringEdge def-String'>"</span>
 49:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>pwd</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 50:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>deleteDir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 51:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>mkdir workspace</span><span class='def-StringEdge def-String'>"</span>
 52:                 <span class='def-LineComment def-Comment def-Syntax'>// Clone scenario repo</span>
 53:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>mkdir -p </span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-StringEdge def-String'>"</span>
 54:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>{</span>
 55:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>git</span> url<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${SCENARIOS_REPOSITORY}</span><span class='def-StringEdge def-String'>"</span>
 56:                 <span class='def-SymbolStrong def-Symbol'>}</span>
 57: 
 58:                 <span class='def-LineComment def-Comment def-Syntax'>// Clone infra repo</span>
 59:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>mkdir -p </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-StringEdge def-String'>"</span>
 60:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>{</span>
 61:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>git</span> url<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRASTRUCTURE_REPOSITORY}</span><span class='def-StringEdge def-String'>"</span>
 62:                 <span class='def-SymbolStrong def-Symbol'>}</span>
 63: 
 64:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
 65: <span class='def-String'>                echo 'jobName: </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 66: <span class='def-String'>                echo 'infrastructureRepository: </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/cloudformation-templates/pattern-1/' >></span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 67: <span class='def-String'>                echo 'deploymentRepository: </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/cloudformation-templates/pattern-1/' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 68: <span class='def-String'>                echo 'scenarioTestsRepository: </span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 69: <span class='def-String'>                echo 'testgridYamlLocation: </span><span class='def-VarStrong def-Var'>${INFRA_CONFIGS_LOCATION}</span><span class='def-String'>/single-node-infra.yaml' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 70: <span class='def-String'></span>
 71: <span class='def-String'>                echo The job-config.yaml:</span>
 72: <span class='def-String'>                cat </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 73: <span class='def-String'>                </span><span class='def-StringEdge def-String'>"""</span>
 74: 
 75:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>stash</span> name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> includes <span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
 76: 
 77:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
 78: <span class='def-String'>                cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
 79: <span class='def-String'>                ./testgrid generate-test-plan \</span>
 80: <span class='def-String'>                    --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
 81: <span class='def-String'>                    --file </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
 82: <span class='def-String'>                </span><span class='def-StringEdge def-String'>"""</span>
 83:             <span class='def-SymbolStrong def-Symbol'>}</span>
 84:         <span class='def-SymbolStrong def-Symbol'>}</span>
 85: 
 86:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>test-plan-run</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 87:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>steps</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 88:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 89:                     <span class='def-Keyword'>def</span> tests <span class='def-Symbol'>=</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-Symbol'>:</span><span class='def-SymbolStrong def-Symbol'>]</span>
 90:                     <span class='def-Keyword'>def</span> testplans <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>findFiles</span><span class='def-SymbolStrong def-Symbol'>(</span>glob<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/test-plans/*.yaml</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 91:                     <span class='def-Keyword'>def</span> arrayLength <span class='def-Symbol'>=</span> testplans<span class='def-Symbol'>.</span>size<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 92:                     <span class='def-Keyword'>def</span> parallelJobs <span class='def-Symbol'>=</span> testplans<span class='def-Symbol'>.</span>size<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>/</span>$<span class='def-SymbolStrong def-Symbol'>{</span>CONCURRENT_JOBS<span class='def-SymbolStrong def-Symbol'>}</span>
 93:                     <span class='def-FunctionKeyword def-Keyword'>println</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>The length of the array is: </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span> arrayLength
 94: 
 95:                     <span class='def-Keyword'>for</span> <span class='def-SymbolStrong def-Symbol'>(</span>f <span class='def-Keyword'>in</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>findFiles</span><span class='def-SymbolStrong def-Symbol'>(</span>glob<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/test-plans/*.yaml</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 96:                         tests<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${f}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span> <span class='def-Symbol'>=</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 97:                             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${f}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 98:                                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 99:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>Running Test-Plan</span><span class='def-StringEdge def-String'>'</span>
100:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>java -version</span><span class='def-StringEdge def-String'>"</span>
101:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>unstash</span> name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
102:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
103: <span class='def-String'>                                    cd </span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-String'></span>
104: <span class='def-String'>                                    git clean -f</span>
105: <span class='def-String'>                                    cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
106: <span class='def-String'>                                    ./testgrid run-testplan --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
107: <span class='def-String'>                                    --file "</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/test-plans/</span><span class='def-VarStrong def-Var'>${f.name}</span><span class='def-String'>"</span>
108: <span class='def-String'>                                    </span><span class='def-StringEdge def-String'>"""</span>
109:                                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>Exception err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
110:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Error : </span><span class='def-VarStrong def-Var'>${err}</span><span class='def-StringEdge def-String'>"</span>
111:                                     currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>FAILURE</span><span class='def-StringEdge def-String'>'</span>
112:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
113:                                 <span class='def-LineComment def-Comment def-Syntax'>// Archive jtl files</span>
114:                                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
115:                                     loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
116:                                     <span class='def-Keyword'>def</span> bucket<span class='def-Symbol'>=</span> properties<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_S3_BUCKET_NAME</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span>
117:                                     <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>null</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
118:                                         bucket<span class='def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>unknown</span><span class='def-StringEdge def-String'>"</span>
119:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
120:                                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>withAWS</span><span class='def-SymbolStrong def-Symbol'>(</span>credentials<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TESTGRID_BOT_CREDENTIALS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
121:                                         <span class='def-LineComment def-Comment def-Syntax'>// Upload artifacts to S3</span>
122:                                         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>s3Upload</span><span class='def-SymbolStrong def-Symbol'>(</span>workingDir<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> includePathPattern<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>**/*.jtl</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> bucket<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> path<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>artifacts/</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
123:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
124:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
125:                                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>RESULT: </span><span class='def-VarStrong def-Var'>${currentBuild.result}</span><span class='def-StringEdge def-String'>"</span>
126:                             <span class='def-SymbolStrong def-Symbol'>}</span>
127:                         <span class='def-SymbolStrong def-Symbol'>}</span>
128:                     <span class='def-SymbolStrong def-Symbol'>}</span>
129:                     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span> tests
130:                 <span class='def-SymbolStrong def-Symbol'>}</span>
131:             <span class='def-SymbolStrong def-Symbol'>}</span>
132:         <span class='def-SymbolStrong def-Symbol'>}</span>
133: 
134: 
135:     <span class='def-SymbolStrong def-Symbol'>}</span>
136: 
137:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>post</span> <span class='def-SymbolStrong def-Symbol'>{</span>
138:         <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>always</span> <span class='def-SymbolStrong def-Symbol'>{</span>
139: 
140:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
141: <span class='def-String'>        cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
142: <span class='def-String'>            ./testgrid finalize-run-testplan \</span>
143: <span class='def-String'>            --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> --workspace </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'></span>
144: <span class='def-String'>            </span><span class='def-StringEdge def-String'>"""</span>
145: 
146:            <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
147: <span class='def-String'>            cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
148: <span class='def-String'>            ./testgrid generate-report \</span>
149: <span class='def-String'>            --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
150: <span class='def-String'>            --groupBy scenario</span>
151: <span class='def-String'>            </span><span class='def-StringEdge def-String'>"""</span>
152:            <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
153:                 loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
154:                 <span class='def-LineComment def-Comment def-Syntax'>// Archive artifacts</span>
155:                 <span class='def-Keyword'>def</span> bucket<span class='def-Symbol'>=</span> properties<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_S3_BUCKET_NAME</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span>
156:                 <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>null</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
157:                     bucket<span class='def-Symbol'>=</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>unknown</span><span class='def-StringEdge def-String'>"</span>
158:                 <span class='def-SymbolStrong def-Symbol'>}</span>
159:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>withAWS</span><span class='def-SymbolStrong def-Symbol'>(</span>credentials<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TESTGRID_BOT_CREDENTIALS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
160:                   <span class='def-LineComment def-Comment def-Syntax'>// Upload artifacts to S3</span>
161:                   <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>s3Upload</span><span class='def-SymbolStrong def-Symbol'>(</span>workingDir<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> includePathPattern<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>**/*.log, **/*.html</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> bucket<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> path<span class='def-Symbol'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>artifacts/</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
162:                 <span class='def-SymbolStrong def-Symbol'>}</span>
163:            <span class='def-SymbolStrong def-Symbol'>}</span>
164:             <span class='def-LineComment def-Comment def-Syntax'>// Delete logs and reports after upload</span>
165:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
166:                 <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
167: <span class='def-String'>                find . -maxdepth 1 -type f </span><span class='def-Comment def-Syntax'>\\</span><span class='def-String'>( -name "*.log" -o -name "*.html" </span><span class='def-Comment def-Syntax'>\\</span><span class='def-String'>) -delete</span>
168: <span class='def-String'>                </span><span class='def-StringEdge def-String'>"""</span>
169:             <span class='def-SymbolStrong def-Symbol'>}</span>
170: 
171:             <span class='def-LineComment def-Comment def-Syntax'>//emailext body: '''$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS:</span>
172: 
173:             <span class='def-LineComment def-Comment def-Syntax'>// Check console output at $BUILD_URL to view the results.''', subject: '$PROJECT_NAME           - Build # $BUILD_NUMBER - $BUILD_STATUS!', to: '</span><span class='def-EMail def-URI'>harshan@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>,</span><span class='def-EMail def-URI'>kasung@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>,</span><span class='def-EMail def-URI'>asmaj@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>,</span><span class='def-EMail def-URI'>viduran@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>,</span><span class='def-EMail def-URI'>sameeraw@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>,</span><span class='def-EMail def-URI'>pasinduj@wso2.com</span><span class='def-LineComment def-Comment def-Syntax'>'</span>
174:        <span class='def-SymbolStrong def-Symbol'>}</span>
175:   <span class='def-SymbolStrong def-Symbol'>}</span>
176: <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
177: 
