  0: properties <span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span>
  1: bucket <span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span>
  2: 
  3: <span class='def-Keyword'>def</span> loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
  4:   node <span class='def-SymbolStrong def-Symbol'>{</span>
  5:     properties <span class='def-Symbol'>=</span> readProperties file<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/config.properties</span><span class='def-StringEdge def-String'>"</span>
  6:   <span class='def-SymbolStrong def-Symbol'>}</span>
  7: <span class='def-SymbolStrong def-Symbol'>}</span>
  8: 
  9: <span class='def-Keyword'>def</span> setS3BucketName<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 10:       script <span class='def-SymbolStrong def-Symbol'>{</span>
 11:         loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 12:       <span class='def-SymbolStrong def-Symbol'>}</span>
 13:       bucket <span class='def-Symbol'>=</span> properties<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_S3_BUCKET_NAME</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>]</span>
 14:       <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>null</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 15:         bucket <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>unknown</span><span class='def-StringEdge def-String'>"</span>
 16:       <span class='def-SymbolStrong def-Symbol'>}</span>
 17: <span class='def-SymbolStrong def-Symbol'>}</span>
 18: 
 19: <span class='def-Keyword'>def</span> uploadToS3<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 20:   sh <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
 21: <span class='def-String'>      aws s3 sync </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/builds/ s3://</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-String'>/artifacts/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/builds --include "*"</span>
 22: <span class='def-String'>      </span><span class='def-StringEdge def-String'>"""</span>
 23: <span class='def-SymbolStrong def-Symbol'>}</span>
 24: 
 25: <span class='def-Keyword'>def</span> truncateTestRunLog<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 26:   sh <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
 27: <span class='def-String'>    if [ -d "</span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/builds" ]; then</span>
 28: <span class='def-String'>        cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'></span>
 29: <span class='def-String'>      for file in builds/*/test-run.log ; do</span>
 30: <span class='def-String'>        truncatedFile=</span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>(dirname </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>file)/truncated-</span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>(basename </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>file);</span>
 31: <span class='def-String'>        head -n 10 </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>file > </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>truncatedFile;</span>
 32: <span class='def-String'>        printf "......</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>.....</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>..(Skipping logs)..</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>.....</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>......</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>" >> </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>truncatedFile;</span>
 33: <span class='def-String'>        grep -B 25 -A 25 -a "Reactor Summary" </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>file >> </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>truncatedFile || true;</span>
 34: <span class='def-String'>        printf "......</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>.....</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>..(Skipping logs)..</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>.....</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>......</span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'>" >> </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>truncatedFile;</span>
 35: <span class='def-String'>        tail -n 50 </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>file >> </span><span class='def-Comment def-Syntax'>\$</span><span class='def-String'>truncatedFile;</span>
 36: <span class='def-String'>      done</span>
 37: <span class='def-String'>    else</span>
 38: <span class='def-String'>        echo no logs found to truncate!</span>
 39: <span class='def-String'>    fi</span>
 40: <span class='def-String'>   </span><span class='def-StringEdge def-String'>"""</span>
 41: <span class='def-SymbolStrong def-Symbol'>}</span>
 42: 
 43: <span class='def-Keyword'>def</span> runPlan<span class='def-SymbolStrong def-Symbol'>(</span>tPlan<span class='def-Symbol'>,</span> node<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 44:   name <span class='def-Symbol'>=</span> getParameters<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>/testgrid/testgrid-home/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${tPlan}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
 45:   notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>STARTED</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>parallel </span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'> Infra : </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span> name<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
 46:   echo <span class='def-StringEdge def-String'>"</span><span class='def-String'>Executing Test Plan : </span><span class='def-VarStrong def-Var'>${tPlan}</span><span class='def-String'> On node : </span><span class='def-VarStrong def-Var'>${node}</span><span class='def-StringEdge def-String'>"</span>
 47:   <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 48:     echo <span class='def-StringEdge def-String'>"</span><span class='def-String'>Running Test-Plan: </span><span class='def-VarStrong def-Var'>${tPlan}</span><span class='def-StringEdge def-String'>"</span>
 49:     sh <span class='def-StringEdge def-String'>"</span><span class='def-String'>java -version</span><span class='def-StringEdge def-String'>"</span>
 50:     unstash name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
 51:     dir<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 52:       unstash name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>test-plans</span><span class='def-StringEdge def-String'>"</span>
 53:     <span class='def-SymbolStrong def-Symbol'>}</span>
 54:     sh <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
 55: <span class='def-String'>      echo "Before PWD"</span>
 56: <span class='def-String'>      pwd</span>
 57: <span class='def-String'>      cd </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-String'></span>
 58: <span class='def-String'>      git clean -fd</span>
 59: <span class='def-String'>      cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
 60: <span class='def-String'>      ./testgrid run-testplan --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
 61: <span class='def-String'>      --file "</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${tPlan}</span><span class='def-String'>"</span>
 62: <span class='def-String'>      </span><span class='def-StringEdge def-String'>"""</span>
 63:     script <span class='def-SymbolStrong def-Symbol'>{</span>
 64:       truncateTestRunLog<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 65:     <span class='def-SymbolStrong def-Symbol'>}</span>
 66:   <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>Exception err<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 67:     echo <span class='def-StringEdge def-String'>"</span><span class='def-String'>Error : </span><span class='def-VarStrong def-Var'>${err}</span><span class='def-StringEdge def-String'>"</span>
 68:     currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UNSTABLE</span><span class='def-StringEdge def-String'>'</span>
 69:   <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>finally</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 70:     notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Parallel </span><span class='def-Comment def-Syntax'>\n</span><span class='def-String'> Infra : </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span> name<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
 71:   <span class='def-SymbolStrong def-Symbol'>}</span>
 72:   echo <span class='def-StringEdge def-String'>"</span><span class='def-String'>RESULT: </span><span class='def-VarStrong def-Var'>${currentBuild.result}</span><span class='def-StringEdge def-String'>"</span>
 73: 
 74:   script <span class='def-SymbolStrong def-Symbol'>{</span>
 75:     uploadToS3<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 76:   <span class='def-SymbolStrong def-Symbol'>}</span>
 77: <span class='def-SymbolStrong def-Symbol'>}</span>
 78: 
 79: 
 80: <span class='def-Keyword'>def</span> getParameters<span class='def-SymbolStrong def-Symbol'>(</span>file<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 81:   <span class='def-Keyword'>def</span> tpyaml <span class='def-Symbol'>=</span> readFile<span class='def-SymbolStrong def-Symbol'>(</span>file<span class='def-SymbolStrong def-Symbol'>)</span>
 82:   <span class='def-Keyword'>def</span> m <span class='def-Symbol'>=</span> tpyaml <span class='def-Symbol'>=</span><span class='def-Symbol'>~</span> <span class='def-StringEdge def-String'>/</span><span class='def-String'>(parameters:)([A-z \n:'0-9\.-]*)(provisioners)</span><span class='def-StringEdge def-String'>/</span>
 83:   <span class='def-LineComment def-Comment def-Syntax'>// echo tpyaml</span>
 84:   <span class='def-Keyword'>def</span> params <span class='def-Symbol'>=</span> m<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='def-NumberDec def-Number'>2</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>.</span>trim<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-Symbol'>.</span>split<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-Comment def-Syntax'>\n</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
 85:   <span class='def-LineComment def-Comment def-Syntax'>// echo Long.toString(params.size())</span>
 86:   <span class='def-Keyword'>def</span> name <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-StringEdge def-String'>"</span>
 87:   params <span class='def-Symbol'>=</span> params<span class='def-Symbol'>.</span>sort<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
 88:   <span class='def-Keyword'>for</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-FunctionKeyword def-Keyword'>String</span> s <span class='def-Symbol'>:</span> params<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 89:     name <span class='def-Symbol'>+</span><span class='def-Symbol'>=</span> s<span class='def-Symbol'>.</span>split<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>:</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>[</span><span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>]</span>
 90:   <span class='def-SymbolStrong def-Symbol'>}</span>
 91:   echo <span class='def-StringEdge def-String'>"</span><span class='def-String'>This is the name</span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span> name
 92:   <span class='def-Keyword'>return</span> name
 93: <span class='def-SymbolStrong def-Symbol'>}</span>
 94: 
 95: <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>pipeline</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
 96:   <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>agent</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
 97:     <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>node</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
 98:       <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>label</span> <span class='def-StringEdge def-String'>"</span><span class='def-StringEdge def-String'>"</span>
 99:       <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>customWorkspace</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>/testgrid/testgrid-home/jobs/</span><span class='def-VarStrong def-Var'>${JOB_BASE_NAME}</span><span class='def-StringEdge def-String'>"</span>
100:     <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
101:   <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
102: 
103:   <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>environment</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
104:     <span class='jenkinsfile-Variable def-Var'>TESTGRID_NAME</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>WSO2-TestGrid</span><span class='def-StringEdge def-String'>'</span>
105:     <span class='jenkinsfile-Variable def-Var'>TESTGRID_DIST_LOCATION</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>/testgrid/testgrid-home/testgrid-dist/</span><span class='def-StringEdge def-String'>'</span>
106:     <span class='jenkinsfile-Variable def-Var'>TESTGRID_HOME</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>/testgrid/testgrid-home/</span><span class='def-StringEdge def-String'>'</span>
107: 
108:     <span class='jenkinsfile-Variable def-Var'>PRODUCT</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_BASE_NAME}</span><span class='def-StringEdge def-String'>"</span>
109: 
110:     <span class='jenkinsfile-Variable def-Var'>TESTGRID_YAML_LOCATION</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/testgrid.yaml</span><span class='def-StringEdge def-String'>"</span>
111: 
112:     <span class='jenkinsfile-Variable def-Var'>AWS_ACCESS_KEY_ID</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_ACCESS_KEY_ID</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
113:     <span class='jenkinsfile-Variable def-Var'>AWS_SECRET_ACCESS_KEY</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>AWS_SECRET_ACCESS_KEY</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
114:     <span class='jenkinsfile-Variable def-Var'>tomcatUsername</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TOMCAT_USERNAME</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
115:     <span class='jenkinsfile-Variable def-Var'>tomcatPassword</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>credentials</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>TOMCAT_PASSWORD</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
116:     <span class='jenkinsfile-Variable def-Var'>PWD</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>pwd</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
117:     <span class='jenkinsfile-Variable def-Var'>JOB_CONFIG_YAML</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>job-config.yaml</span><span class='def-StringEdge def-String'>"</span>
118:     <span class='jenkinsfile-Variable def-Var'>JOB_CONFIG_YAML_PATH</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
119: 
120:     <span class='jenkinsfile-Variable def-Var'>PRODUCT_GIT_URL</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_URL}</span><span class='def-StringEdge def-String'>"</span>
121:     <span class='jenkinsfile-Variable def-Var'>PRODUCT_GIT_BRANCH</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_BRANCH}</span><span class='def-StringEdge def-String'>"</span>
122:     <span class='jenkinsfile-Variable def-Var'>PRODUCT_DIST_DOWNLOAD_API</span> <span class='jenkinsfile-Symbol def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PRODUCT_DIST_DOWNLOAD_API}</span><span class='def-StringEdge def-String'>"</span>
123:   <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
124: 
125:   <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>tools</span> <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>{</span>
126:     <span class='jenkinsfile-ConfigurationMethod def-StructKeyword def-Keyword'>jdk</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>jdk8</span><span class='def-StringEdge def-String'>'</span>
127:   <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
128: 
129:   <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stages</span> <span class='def-SymbolStrong def-Symbol'>{</span>
130:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>Preparation</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
131:       <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>steps</span> <span class='def-SymbolStrong def-Symbol'>{</span>
132:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
133:           <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
134:             setS3BucketName<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
135:             notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>STARTED</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Initiation</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
136:             notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>STARTED</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Initiation</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
137:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>pwd</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
138:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>deleteDir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
139: 
140:             <span class='def-LineComment def-Comment def-Syntax'>// Clone scenario repo</span>
141:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>mkdir -p </span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-StringEdge def-String'>"</span>
142:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
143:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>git</span> branch<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>master</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${SCENARIOS_REPOSITORY}</span><span class='def-StringEdge def-String'>"</span>
144:             <span class='def-SymbolStrong def-Symbol'>}</span>
145: 
146:             <span class='def-LineComment def-Comment def-Syntax'>// Clone infra repo</span>
147:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>mkdir -p </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-StringEdge def-String'>"</span>
148:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
149:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>git</span> branch<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>master</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> url<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRASTRUCTURE_REPOSITORY}</span><span class='def-StringEdge def-String'>"</span>
150:             <span class='def-SymbolStrong def-Symbol'>}</span>
151:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>writeFile</span> file<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/deploy.sh</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> text<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>#!/bin/sh</span><span class='def-StringEdge def-String'>'</span>
152: 
153:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
154: <span class='def-String'>              echo </span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
155: <span class='def-String'>              cd </span><span class='def-VarStrong def-Var'>${TESTGRID_DIST_LOCATION}</span><span class='def-String'></span>
156: <span class='def-String'>              cd </span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
157: <span class='def-String'></span>
158: <span class='def-String'>              sed -i 's/-Xms256m -Xmx1024m/-Xmx2G -Xms2G/g' testgrid</span>
159: <span class='def-String'>              </span><span class='def-StringEdge def-String'>"""</span>
160: 
161:             <span class='def-LineComment def-Comment def-Syntax'>// Get testgrid.yaml from jenkins managed files</span>
162:             configFileProvider<span class='def-SymbolStrong def-Symbol'>(</span>
163:                     <span class='def-SymbolStrong def-Symbol'>[</span>configFile<span class='def-SymbolStrong def-Symbol'>(</span>fileId<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>-testgrid-yaml</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> targetLocation<span class='def-Symbol'>:</span>
164:                             <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${TESTGRID_YAML_LOCATION}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
165:             <span class='def-SymbolStrong def-Symbol'>}</span>
166: 
167:             configFileProvider<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>[</span>configFile<span class='def-SymbolStrong def-Symbol'>(</span>fileId<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>3a63892b-06b8-483a-8a0d-74dffaf69c3d</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> targetLocation<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>workspace/testgrid-key.pem</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> variable<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>TESTGRIDKEY</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
168:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
169: <span class='def-String'>                echo 'keyFileLocation: workspace/testgrid-key.pem' > </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
170: <span class='def-String'>                chmod 400 workspace/testgrid-key.pem</span>
171: <span class='def-String'>                </span><span class='def-StringEdge def-String'>"""</span>
172:             <span class='def-SymbolStrong def-Symbol'>}</span>
173: 
174:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
175: <span class='def-String'>              echo 'infrastructureRepository: </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
176: <span class='def-String'>              echo 'deploymentRepository: </span><span class='def-VarStrong def-Var'>${INFRA_LOCATION}</span><span class='def-String'>/' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
177: <span class='def-String'>              echo 'scenarioTestsRepository: </span><span class='def-VarStrong def-Var'>${SCENARIOS_LOCATION}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
178: <span class='def-String'>              echo 'testgridYamlLocation: </span><span class='def-VarStrong def-Var'>${TESTGRID_YAML_LOCATION}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
179: <span class='def-String'>              echo 'properties:' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
180: <span class='def-String'>              echo '  PRODUCT_GIT_URL: </span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_URL}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
181: <span class='def-String'>              echo '  PRODUCT_GIT_BRANCH: </span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_BRANCH}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
182: <span class='def-String'>              echo '  PRODUCT_DIST_DOWNLOAD_API: </span><span class='def-VarStrong def-Var'>${PRODUCT_DIST_DOWNLOAD_API}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
183: <span class='def-String'>              echo '  SQL_DRIVERS_LOCATION_UNIX: </span><span class='def-VarStrong def-Var'>${SQL_DRIVERS_LOCATION_UNIX}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
184: <span class='def-String'>              echo '  SQL_DRIVERS_LOCATION_WINDOWS: </span><span class='def-VarStrong def-Var'>${SQL_DRIVERS_LOCATION_WINDOWS}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
185: <span class='def-String'>              echo '  SSH_KEY_LOCATION: </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/workspace/testgrid-key.pem' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
186: <span class='def-String'>              echo '  REMOTE_WORKSPACE_DIR_UNIX: </span><span class='def-VarStrong def-Var'>${REMOTE_WORKSPACE_DIR_UNIX}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
187: <span class='def-String'>              echo '  REMOTE_WORKSPACE_DIR_WINDOWS: </span><span class='def-VarStrong def-Var'>${REMOTE_WORKSPACE_DIR_WINDOWS}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
188: <span class='def-String'>              echo '  gitURL: </span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_URL}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
189: <span class='def-String'>              echo '  gitBranch: </span><span class='def-VarStrong def-Var'>${PRODUCT_GIT_BRANCH}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
190: <span class='def-String'>              echo '  productDistDownloadApi: </span><span class='def-VarStrong def-Var'>${PRODUCT_DIST_DOWNLOAD_API}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
191: <span class='def-String'>              echo '  sqlDriversLocationUnix: </span><span class='def-VarStrong def-Var'>${SQL_DRIVERS_LOCATION_UNIX}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
192: <span class='def-String'>              echo '  sqlDriversLocationWindows: </span><span class='def-VarStrong def-Var'>${SQL_DRIVERS_LOCATION_WINDOWS}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
193: <span class='def-String'>              echo '  sshKeyFileLocation: </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/workspace/testgrid-key.pem' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
194: <span class='def-String'>              echo '  RemoteWorkspaceDirPosix: </span><span class='def-VarStrong def-Var'>${REMOTE_WORKSPACE_DIR_UNIX}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
195: <span class='def-String'>              echo '  LATEST_PRODUCT_RELEASE_API: </span><span class='def-VarStrong def-Var'>${LATEST_PRODUCT_RELEASE_API}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
196: <span class='def-String'>              echo '  LATEST_PRODUCT_BUILD_ARTIFACTS_API: </span><span class='def-VarStrong def-Var'>${LATEST_PRODUCT_BUILD_ARTIFACTS_API}</span><span class='def-String'>' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
197: <span class='def-String'>              echo '  TEST_MODE: </span><span class='def-VarStrong def-Var'>${TEST_MODE}</span><span class='def-String'> >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
198: <span class='def-String'>              echo '  runOnBranch: "false"' >> </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
199: <span class='def-String'></span>
200: <span class='def-String'>              echo The job-config.yaml:</span>
201: <span class='def-String'>              cat </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
202: <span class='def-String'>              </span><span class='def-StringEdge def-String'>"""</span>
203: 
204:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>stash</span> name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> includes<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML}</span><span class='def-StringEdge def-String'>"</span>
205: 
206:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
207: <span class='def-String'>              cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
208: <span class='def-String'>              ./testgrid generate-test-plan \</span>
209: <span class='def-String'>                  --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
210: <span class='def-String'>                  --file </span><span class='def-VarStrong def-Var'>${JOB_CONFIG_YAML_PATH}</span><span class='def-String'></span>
211: <span class='def-String'>              </span><span class='def-StringEdge def-String'>"""</span>
212:             <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>dir</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
213:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>stash</span> name<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>test-plans</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> includes<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>test-plans/**</span><span class='def-StringEdge def-String'>"</span>
214:             <span class='def-SymbolStrong def-Symbol'>}</span>
215:           <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>e<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
216:             currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>FAILED</span><span class='def-StringEdge def-String'>"</span>
217:           <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>finally</span> <span class='def-SymbolStrong def-Symbol'>{</span>
218:             notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>preparation</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
219:           <span class='def-SymbolStrong def-Symbol'>}</span>
220:         <span class='def-SymbolStrong def-Symbol'>}</span>
221:       <span class='def-SymbolStrong def-Symbol'>}</span>
222: 
223:     <span class='def-SymbolStrong def-Symbol'>}</span>
224: 
225:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>'</span><span class='def-String'>parallel-run</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
226:       <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>steps</span> <span class='def-SymbolStrong def-Symbol'>{</span>
227:         <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
228:           <span class='def-Keyword'>def</span> name <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>unknown</span><span class='def-StringEdge def-String'>"</span>
229:           <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
230:             <span class='def-Keyword'>def</span> parallelExecCount <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>12</span>
231:             <span class='def-Keyword'>def</span> tests <span class='def-Symbol'>=</span> <span class='def-SymbolStrong def-Symbol'>[</span><span class='def-Symbol'>:</span><span class='def-SymbolStrong def-Symbol'>]</span>
232:             <span class='def-Keyword'>def</span> files <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>findFiles</span><span class='def-SymbolStrong def-Symbol'>(</span>glob<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>**/test-plans/*.yaml</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span>
233:             <span class='def-Keyword'>for</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-Keyword'>int</span> f <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span> f <span class='def-Symbol'>&lt;</span> parallelExecCount <span class='def-Symbol'>+</span> <span class='def-NumberDec def-Number'>1</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> f <span class='def-Symbol'>&lt;</span><span class='def-Symbol'>=</span> files<span class='def-Symbol'>.</span>length<span class='def-SymbolStrong def-Symbol'>;</span> f<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
234:               <span class='def-Keyword'>def</span> executor <span class='def-Symbol'>=</span> f
235:               name <span class='def-Symbol'>=</span> getParameters<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/test-plans/</span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span> files<span class='def-SymbolStrong def-Symbol'>[</span>f <span class='def-Symbol'>-</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>.</span>name<span class='def-SymbolStrong def-Symbol'>)</span>
236:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> name
237:               tests<span class='def-SymbolStrong def-Symbol'>[</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${name}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>]</span> <span class='def-Symbol'>=</span> <span class='def-SymbolStrong def-Symbol'>{</span>
238:                 <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>node</span> <span class='def-SymbolStrong def-Symbol'>{</span>
239:                   <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>stage</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-String'>Parallel Executor : </span><span class='def-VarStrong def-Var'>${executor}</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
240:                     <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
241:                       <span class='def-Keyword'>int</span> processFileCount <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
242:                       <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>files<span class='def-Symbol'>.</span>length <span class='def-Symbol'>&lt;</span> parallelExecCount<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
243:                         processFileCount <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span>
244:                       <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
245:                         processFileCount <span class='def-Symbol'>=</span> files<span class='def-Symbol'>.</span>length <span class='def-Symbol'>/</span> parallelExecCount<span class='def-SymbolStrong def-Symbol'>;</span>
246:                       <span class='def-SymbolStrong def-Symbol'>}</span>
247:                       <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>executor <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> parallelExecCount<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
248:                         <span class='def-Keyword'>for</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-Keyword'>int</span> i <span class='def-Symbol'>=</span> processFileCount <span class='def-Symbol'>*</span> <span class='def-SymbolStrong def-Symbol'>(</span>executor <span class='def-Symbol'>-</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> i <span class='def-Symbol'>&lt;</span> files<span class='def-Symbol'>.</span>length<span class='def-SymbolStrong def-Symbol'>;</span> i<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
249:                           <span class='def-LineComment def-Comment def-Syntax'>// Execution logic</span>
250:                           runPlan<span class='def-SymbolStrong def-Symbol'>(</span>files<span class='def-SymbolStrong def-Symbol'>[</span>i<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>node1</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
251:                         <span class='def-SymbolStrong def-Symbol'>}</span>
252:                       <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
253:                         <span class='def-Keyword'>for</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='def-Keyword'>int</span> i <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span> i <span class='def-Symbol'>&lt;</span> processFileCount<span class='def-SymbolStrong def-Symbol'>;</span> i<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
254:                           <span class='def-Keyword'>int</span> fileNo <span class='def-Symbol'>=</span> processFileCount <span class='def-Symbol'>*</span> <span class='def-SymbolStrong def-Symbol'>(</span>executor <span class='def-Symbol'>-</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-Symbol'>+</span> i
255:                           runPlan<span class='def-SymbolStrong def-Symbol'>(</span>files<span class='def-SymbolStrong def-Symbol'>[</span>fileNo<span class='def-SymbolStrong def-Symbol'>]</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>node1</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
256:                         <span class='def-SymbolStrong def-Symbol'>}</span>
257:                       <span class='def-SymbolStrong def-Symbol'>}</span>
258:                     <span class='def-SymbolStrong def-Symbol'>}</span>
259:                   <span class='def-SymbolStrong def-Symbol'>}</span>
260:                 <span class='def-SymbolStrong def-Symbol'>}</span>
261:               <span class='def-SymbolStrong def-Symbol'>}</span>
262:             <span class='def-SymbolStrong def-Symbol'>}</span>
263:             <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>parallel</span> tests
264:           <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>e<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
265:             currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>FAILED</span><span class='def-StringEdge def-String'>"</span>
266:             notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Parallel</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
267:           <span class='def-SymbolStrong def-Symbol'>}</span>
268:         <span class='def-SymbolStrong def-Symbol'>}</span>
269:       <span class='def-SymbolStrong def-Symbol'>}</span>
270:     <span class='def-SymbolStrong def-Symbol'>}</span>
271:   <span class='def-SymbolStrong def-Symbol'>}</span>
272: 
273:   <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>post</span> <span class='def-SymbolStrong def-Symbol'>{</span>
274:     <span class='jenkinsfile-MainMethod def-ClassKeyword def-Keyword'>always</span> <span class='def-SymbolStrong def-Symbol'>{</span>
275:       <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
276:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
277:           loadProperties<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-SymbolStrong def-Symbol'>)</span>
278:           <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
279: <span class='def-String'>            cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
280: <span class='def-String'>            ./testgrid finalize-run-testplan \</span>
281: <span class='def-String'>            --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> --workspace </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'></span>
282: <span class='def-String'>            </span><span class='def-StringEdge def-String'>"""</span>
283: 
284:           <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
285: <span class='def-String'>             cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
286: <span class='def-String'>            ./testgrid generate-report \</span>
287: <span class='def-String'>            --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
288: <span class='def-String'>            --groupBy scenario</span>
289: <span class='def-String'>            </span><span class='def-StringEdge def-String'>"""</span>
290:           <span class='def-LineComment def-Comment def-Syntax'>// Generate email-able report</span>
291:           <span class='def-Comment def-Syntax'>/* Prereq:</span>
292: <span class='def-Comment def-Syntax'>         1. Needs TestSuit.txt and output.properties files in relevant scenario directory.</span>
293: <span class='def-Comment def-Syntax'>         2. DB needs to be updated on integration test result statues.</span>
294: <span class='def-Comment def-Syntax'>      */</span>
295:           <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>sh</span> <span class='def-StringEdge def-String'>"""</span><span class='def-String'></span>
296: <span class='def-String'>                cd </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/testgrid-dist/</span><span class='def-VarStrong def-Var'>${TESTGRID_NAME}</span><span class='def-String'></span>
297: <span class='def-String'>                ./testgrid generate-email \</span>
298: <span class='def-String'>                --product </span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'> \</span>
299: <span class='def-String'>                --workspace </span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'></span>
300: <span class='def-String'></span>
301: <span class='def-String'>                aws s3 sync </span><span class='def-VarStrong def-Var'>${TESTGRID_HOME}</span><span class='def-String'>/jobs/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/builds/ s3://</span><span class='def-VarStrong def-Var'>${bucket}</span><span class='def-String'>/charts/</span><span class='def-VarStrong def-Var'>${PRODUCT}</span><span class='def-String'>/ --include "*.png" --acl public-read</span>
302: <span class='def-String'>                </span><span class='def-StringEdge def-String'>"""</span>
303:           <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>script</span> <span class='def-SymbolStrong def-Symbol'>{</span>
304: 
305:             <span class='def-LineComment def-Comment def-Syntax'>//Send email for failed results.</span>
306:             <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span><span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>fileExists</span><span class='def-SymbolStrong def-Symbol'>(</span><span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/builds/SummarizedEmailReport.html</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
307:               <span class='def-Keyword'>def</span> emailBody <span class='def-Symbol'>=</span> <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>readFile</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${PWD}</span><span class='def-String'>/builds/SummarizedEmailReport.html</span><span class='def-StringEdge def-String'>"</span>
308:               emailext<span class='def-SymbolStrong def-Symbol'>(</span>to<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${EMAIL_TO_LIST}</span><span class='def-String'>,kasung@wso2.com,lasanthad@wso2.com,yasassri@wso2.com</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
309:                       subject<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>'</span><span class='def-VarStrong def-Var'>${env.JOB_NAME}</span><span class='def-String'>' Integration Test Failure! #(</span><span class='def-VarStrong def-Var'>${env.BUILD_NUMBER}</span><span class='def-String'>)</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
310:                       body<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${emailBody}</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> mimeType<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>text/html</span><span class='def-StringEdge def-String'>'</span>
311:               <span class='def-SymbolStrong def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
312:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
313:               <span class='jenkinsfile-OtherMethod def-FunctionKeyword def-Keyword'>echo</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>No SummarizedEmailReport.html file found!!</span><span class='def-StringEdge def-String'>"</span>
314:               emailext<span class='def-SymbolStrong def-Symbol'>(</span>to<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>sameeraw@wso2.com,lasanthad@wso2.com,yasassri@wso2.com,kasung@wso2.com</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span>
315:                       subject<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>'</span><span class='def-VarStrong def-Var'>${env.JOB_NAME}</span><span class='def-String'>'#(</span><span class='def-VarStrong def-Var'>${env.BUILD_NUMBER}</span><span class='def-String'>) - SummarizedEmailReport.html file not found</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
316:                       body<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>Could not find the summarized email report </span><span class='def-VarStrong def-Var'>${env.BUILD_URL}</span><span class='def-String'>. This is an error in </span><span class='def-StringEdge def-String'>"</span> <span class='def-Symbol'>+</span>
317:                               <span class='def-StringEdge def-String'>"</span><span class='def-String'>testgrid.</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span>
318:                       mimeType<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>text/html</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> attachmentsPattern<span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>**/builds/*.png</span><span class='def-StringEdge def-String'>"</span>
319:               <span class='def-SymbolStrong def-Symbol'>)</span>
320:             <span class='def-SymbolStrong def-Symbol'>}</span>
321:           <span class='def-SymbolStrong def-Symbol'>}</span>
322:           <span class='def-LineComment def-Comment def-Syntax'>// Delete logs and reports after upload</span>
323:           <span class='def-LineComment def-Comment def-Syntax'>//     dir("${TESTGRID_HOME}/jobs/${PRODUCT}") {</span>
324:           <span class='def-LineComment def-Comment def-Syntax'>//         sh """</span>
325:           <span class='def-LineComment def-Comment def-Syntax'>// find . -maxdepth 1 -type f \\( -name "*.log" -o -name "*.html" \\) -delete</span>
326:           <span class='def-LineComment def-Comment def-Syntax'>// """</span>
327:           <span class='def-LineComment def-Comment def-Syntax'>//     }</span>
328:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-SymbolStrong def-Symbol'>(</span>e<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
329:           currentBuild<span class='def-Symbol'>.</span>result <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>FAILED</span><span class='def-StringEdge def-String'>"</span>
330:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>finally</span> <span class='def-SymbolStrong def-Symbol'>{</span>
331:           notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>completed</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
332:           notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span>currentBuild<span class='def-Symbol'>.</span>result<span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>completed</span><span class='def-StringEdge def-String'>"</span><span class='def-Symbol'>,</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#build_status_verbose</span><span class='def-StringEdge def-String'>"</span><span class='def-SymbolStrong def-Symbol'>)</span>
333:         <span class='def-SymbolStrong def-Symbol'>}</span>
334:       <span class='def-SymbolStrong def-Symbol'>}</span>
335:     <span class='def-SymbolStrong def-Symbol'>}</span>
336: 
337:   <span class='def-SymbolStrong def-Symbol'>}</span>
338: <span class='jenkinsfile-SymbolStrong def-SymbolStrong def-Symbol'>}</span>
339: 
340: <span class='def-Keyword'>def</span> notifyBuild<span class='def-SymbolStrong def-Symbol'>(</span><span class='def-FunctionKeyword def-Keyword'>String</span> buildStatus <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>STARTED</span><span class='def-StringEdge def-String'>'</span><span class='def-Symbol'>,</span> phase<span class='def-Symbol'>,</span> channel<span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
341:   <span class='def-LineComment def-Comment def-Syntax'>// build status of null means successful</span>
342:   buildStatus <span class='def-Symbol'>=</span> buildStatus <span class='def-Symbol'>?</span><span class='def-Symbol'>:</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span>
343: 
344:   <span class='def-LineComment def-Comment def-Syntax'>// Default values</span>
345:   <span class='def-Keyword'>def</span> colorName <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>RED</span><span class='def-StringEdge def-String'>'</span>
346:   <span class='def-Keyword'>def</span> colorCode <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>#FF0000</span><span class='def-StringEdge def-String'>'</span>
347:   <span class='def-Keyword'>def</span> subject <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${buildStatus}</span><span class='def-String'>: Job '</span><span class='def-VarStrong def-Var'>${env.JOB_NAME}</span><span class='def-String'> [</span><span class='def-VarStrong def-Var'>${env.BUILD_NUMBER}</span><span class='def-String'>]'</span><span class='def-StringEdge def-String'>"</span>
348:   <span class='def-Keyword'>def</span> summary <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-VarStrong def-Var'>${subject}</span><span class='def-String'> (</span><span class='def-VarStrong def-Var'>${env.RUN_DISPLAY_URL}</span><span class='def-String'>) in phase : </span><span class='def-VarStrong def-Var'>$phase</span><span class='def-StringEdge def-String'>"</span>
349: 
350:   <span class='def-LineComment def-Comment def-Syntax'>// Override default values based on build status</span>
351:   <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>buildStatus <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>STARTED</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
352:     color <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>BLUE</span><span class='def-StringEdge def-String'>'</span>
353:     colorCode <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>#003EFF</span><span class='def-StringEdge def-String'>'</span>
354:   <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>buildStatus <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>SUCCESS</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
355:     color <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>GREEN</span><span class='def-StringEdge def-String'>'</span>
356:     colorCode <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>#00FF00</span><span class='def-StringEdge def-String'>'</span>
357:   <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-Keyword'>if</span> <span class='def-SymbolStrong def-Symbol'>(</span>buildStatus <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>UNSTABLE</span><span class='def-StringEdge def-String'>'</span><span class='def-SymbolStrong def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
358:     color <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>YELLOW</span><span class='def-StringEdge def-String'>"</span>
359:     colorCode <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>"</span><span class='def-String'>#FFFF00</span><span class='def-StringEdge def-String'>"</span>
360:   <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
361:     color <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>RED</span><span class='def-StringEdge def-String'>'</span>
362:     colorCode <span class='def-Symbol'>=</span> <span class='def-StringEdge def-String'>'</span><span class='def-String'>#FF0000</span><span class='def-StringEdge def-String'>'</span>
363:   <span class='def-SymbolStrong def-Symbol'>}</span>
364: 
365:   <span class='def-LineComment def-Comment def-Syntax'>// Send notifications</span>
366:   slackSend<span class='def-SymbolStrong def-Symbol'>(</span>channel<span class='def-Symbol'>:</span> channel<span class='def-Symbol'>,</span> color<span class='def-Symbol'>:</span> colorCode<span class='def-Symbol'>,</span> message<span class='def-Symbol'>:</span> summary<span class='def-SymbolStrong def-Symbol'>)</span>
367: 
368: <span class='def-SymbolStrong def-Symbol'>}</span>
369: 
